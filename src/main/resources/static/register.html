<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>≈ûagird Qeydiyyatƒ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #42cea2, #2b7a46);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            overflow-x: hidden;
        }
        .form-container, .card-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 480px;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
            animation: slideUp 0.6s ease-out;
        }
        @keyframes slideUp {
            from {opacity:0; transform:translateY(30px);}
            to {opacity:1; transform:translateY(0);}
        }
        h2 {
            text-align:center;
            font-size:28px;
            font-weight:700;
            margin-bottom:30px;
            background: linear-gradient(135deg,#2ecc71,#27ae60);
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
        }
        input, select {
            width:100%;
            padding:14px 16px;
            border:2px solid #e2e8f0;
            border-radius:12px;
            font-size:15px;
            font-family:'Inter',sans-serif;
            transition: all 0.3s ease;
            background:#fff;
        }
        input:focus, select:focus {
            border-color:#27ae60;
            outline:none;
            box-shadow:0 0 0 4px rgba(39,174,96,0.1);
            transform:translateY(-2px);
        }
        button {
            width:100%;
            padding:14px;
            margin-top:10px;
            background:linear-gradient(135deg,#42cea2,#2b7a46);
            color:white;
            font-size:16px;
            font-weight:600;
            border:none;
            border-radius:12px;
            cursor:pointer;
            transition: all 0.3s ease;
            box-shadow:0 4px 15px rgba(46,204,113,0.4);
        }
        button:hover {
            transform:translateY(-2px);
            box-shadow:0 6px 20px rgba(39,174,96,0.6);
        }
        #result {
            margin-top:20px;
            padding:14px;
            border-radius:12px;
            font-weight:500;
            text-align:center;
        }
        #result.success { background:#d4edda; color:#155724; border:1px solid #c3e6cb; }
        #result.error { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; }

        /* Kart Dizaynƒ± */
        .card {
            border-radius:16px;
            padding:24px;
            background: linear-gradient(135deg,#f6f8fb 0%,#ffffff 100%);
            font-family: 'Inter', sans-serif;
            box-shadow:0 10px 30px rgba(0,0,0,0.2);
            border:3px solid #27ae60;
        }
        .card-header {
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:15px;
        }
        .card-header h1 {
            font-size:18px;
            background:linear-gradient(135deg,#42cea2,#2b7a46);
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
            margin:0;
        }
        .card-header p {
            font-size:12px;
            color:#555;
            margin:0;
        }
        .card p {
            margin:8px 0;
            font-size:15px;
            color:#2d3748;
            display:flex;
            justify-content:space-between;
        }
        .card p strong { color:#1a202c; }
        .btn-group { display:flex; gap:12px; margin-top:20px; }
        .btn-group button:nth-child(2) { background:linear-gradient(135deg,#1abc9c,#16a085); }
        /* √úmumi √ºslublar */
        body {
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background-color: #f5f6fa;
            padding-top: 80px; /* header sabit olduƒüu √º√ß√ºn m…ôzmun yuxarƒ±ya girm…ôsin */
        }

        /* Header dizaynƒ± */
        header {
            background: linear-gradient(90deg, #00b894, #00cec9);
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }

        /* Ba≈ülƒ±q */
        header h1 {
            font-size: 1.6rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Naviqasiya */
        nav {
            display: flex;
            gap: 25px;
        }

        /* Naviqasiya linkl…ôri */
        nav a {
            text-decoration: none;
            color: #ffffff;
            font-weight: 500;
            transition: 0.3s ease;
            padding: 8px 14px;
            border-radius: 8px;
        }

        /* Hover effekti */
        nav a:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Aktiv s…ôhif…ô */
        nav a.active {
            background-color: rgba(255, 255, 255, 0.25);
            font-weight: 600;
        }

        /* Mobil uyƒüunluq */
        @media (max-width: 700px) {
            header {
                flex-direction: column;
                align-items: flex-start;
                padding: 20px;
            }

            nav {
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 10px;
            }
        }

    </style>
</head>

<body>
<header>
    <h1>üìò ƒ∞mtahanlarƒ±n ƒ∞dar…ô Paneli</h1>
    <nav>
        <a href="index.html">üè† Ana s…ôhif…ô</a>
        <a href="room.html">üè´ Otaqlar</a>
        <a href="students.html">üë®‚Äçüéì T…ôl…ôb…ôl…ôr</a>
    </nav>
</header>

<!-- Qeydiyyat Formu -->
<div class="form-container">
    <h2>≈ûagird Qeydiyyatƒ±</h2>
    <form id="studentForm">
        <input type="text" name="name" placeholder="Ad" required><br><br>
        <input type="text" name="surname" placeholder="Soyad" required><br><br>
        <input type="text" name="fatherName" placeholder="Ata adƒ±" required><br><br>
        <input type="number" name="grade" placeholder="Sinif" required><br><br>
        <input type="text" name="phone" placeholder="Telefon n√∂mr…ôsi" required><br><br>

        <select name="examId" required>
            <option value="">ƒ∞mtahan se√ßin</option>
            <option value="2">Riyaziyyat Sƒ±naq 2</option>
        </select><br><br>

        <div style="display:flex;align-items:center;gap:10px;">
            <input type="checkbox" id="bspStudent" name="bspStudent" style="width:20px;height:20px;">
            <label for="bspStudent" style="font-size:15px;">BSP LearnUp t…ôl…ôb…ôsiy…ôm</label>
        </div>
        <button type="submit">Qeyd et</button>
    </form>
    <div id="result"></div>
</div>

<!-- ƒ∞mtahan Kartƒ± -->
<div class="card-container" id="cardContainer" style="display:none;">
    <div class="card" id="printCard">
        <div class="card-header">
            <img src="mathbsp-az-qr-code.png" alt="QR Kod" style="width:80px;height:80px;">
            <div style="text-align:right;">
                <h1>Riyaziyyat Buraxƒ±lƒ±≈ü Sƒ±naq 2</h1>
                <p><span id="cardDate"></span> | <span id="cardTime"></span></p>
            </div>
        </div>
        <p><strong>Ad Soyad Ata adƒ±:</strong> <span id="cardName"></span></p>
        <p><strong>ƒ∞≈ü n√∂mr…ôsi:</strong> <span id="cardCode"></span></p>
        <p><strong>Sinif:</strong> <span id="cardGrade"></span></p>
        <p><strong>Otaq / Yer:</strong> <span id="cardRoom"></span> / <span id="cardSeat"></span></p>
        <p><strong>BSP t…ôl…ôb…ôsidir:</strong> <span id="cardBsp"></span></p>
        <p><strong>√únvan:</strong> Bakƒ±xanov q…ôs., Villa Plaza</p>
        <p><strong>Saat:</strong> 10:00</p>
    </div>
    <div class="btn-group">
        <button onclick="printCard()">√áap et</button>
        <button onclick="downloadPDF()">PDF Y√ºkl…ô</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
    // Form Submit
    document.getElementById('studentForm').addEventListener('submit', async (e)=>{
        e.preventDefault();
        const formData = Object.fromEntries(new FormData(e.target).entries());
        formData.bspStudent = document.getElementById('bspStudent').checked;
        formData.examId = parseInt(formData.examId);

        const resultDiv = document.getElementById('result');
        const cardContainer = document.getElementById('cardContainer');

        try{
            const res = await fetch('/api/students/add', {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify(formData)
            });
            if(!res.ok) throw new Error(await res.text());
            const student = await res.json();

            // Dinamik Kart Doldur
            document.getElementById('cardName').innerText = `${student.name} ${student.surname} ${student.fatherName}`;
            document.getElementById('cardGrade').innerText = student.grade;
            document.getElementById('cardCode').innerText = student.studentCode;
            document.getElementById('cardRoom').innerText = student.room.roomNo;
            document.getElementById('cardSeat').innerText = student.seatNo;
            document.getElementById('cardBsp').innerHTML = student.bspStudent
                ? "<span style='color:green;font-weight:bold;'>B…ôli ‚úÖ</span>"
                : "<span style='color:red;font-weight:bold;'>Xeyr ‚ùå</span>";

            // Dinamik tarix v…ô saat
            const now = new Date();
            document.getElementById('cardDate').innerText = now.toLocaleDateString();
            document.getElementById('cardTime').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});

            cardContainer.style.display = 'block';
            resultDiv.className = "success";
            resultDiv.innerText = "≈ûagird uƒüurla qeydiyyatdan ke√ßdi!";
        } catch(err){
            resultDiv.className = "error";
            resultDiv.innerText = err.message;
            cardContainer.style.display = 'none';
        }
    });

    // √áap funksiyasƒ±
    function printCard() {
        const card = document.getElementById('printCard').outerHTML;
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`<html><head><title>Giri≈ü Kartƒ±</title></head><body>${card}</body></html>`);
        printWindow.document.close();
        printWindow.focus();
        setTimeout(() => printWindow.print(), 250);
    }

    // PDF Y√ºkl…ôm…ô funksiyasƒ±
    function downloadPDF(){
        const element=document.getElementById('printCard');
        html2pdf().set({
            margin:0,
            filename:`${document.getElementById('cardName').innerText}_Giris_Karti.pdf`,
            image:{type:'jpeg',quality:0.98},
            html2canvas:{scale:3},
            jsPDF:{unit:'mm',format:[105,148],orientation:'portrait'}
        }).from(element).save();
    }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
    const form = document.getElementById('studentForm');
    const submitBtn = form.querySelector('button[type="submit"]'); // üü¢ d√ºym…ôni se√ßirik

    form.addEventListener('submit', async (e)=>{
        e.preventDefault();

        // üü¢ 1. D√ºym…ôni deaktiv edib "Y√ºkl…ônir..." g√∂st…ôricisi …ôlav…ô edirik
        submitBtn.disabled = true;
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = `<span style="display:inline-flex;align-items:center;gap:8px;">
            <div class="loader" style="border:3px solid #fff;border-top:3px solid transparent;border-radius:50%;width:16px;height:16px;animation:spin 1s linear infinite;"></div>
            Y√ºkl…ônir...
        </span>`;

        const formData = Object.fromEntries(new FormData(e.target).entries());
        formData.bspStudent = document.getElementById('bspStudent').checked;
        formData.examId = parseInt(formData.examId);

        const resultDiv = document.getElementById('result');
        const cardContainer = document.getElementById('cardContainer');

        try{
            const res = await fetch('/api/students/add', {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify(formData)
            });
            if(!res.ok) throw new Error(await res.text());
            const student = await res.json();

            // Kart m…ôlumatlarƒ±nƒ± doldur
            document.getElementById('cardName').innerText = `${student.name} ${student.surname} ${student.fatherName}`;
            document.getElementById('cardGrade').innerText = student.grade;
            document.getElementById('cardCode').innerText = student.studentCode;
            document.getElementById('cardRoom').innerText = student.room.roomNo;
            document.getElementById('cardSeat').innerText = student.seatNo;
            document.getElementById('cardBsp').innerHTML = student.bspStudent
                ? "<span style='color:green;font-weight:bold;'>B…ôli ‚úÖ</span>"
                : "<span style='color:red;font-weight:bold;'>Xeyr ‚ùå</span>";

            const now = new Date();
            document.getElementById('cardDate').innerText = now.toLocaleDateString();
            document.getElementById('cardTime').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});

            cardContainer.style.display = 'block';
            resultDiv.className = "success";
            resultDiv.innerText = "≈ûagird uƒüurla qeydiyyatdan ke√ßdi!";
        } catch(err){
            resultDiv.className = "error";
            resultDiv.innerText = err.message;
            cardContainer.style.display = 'none';
        } finally {
            // üü¢ 2. ∆èm…ôliyyat bit…ônd…ô d√ºym…ôni b…ôrpa edirik
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }
    });

    // üü¢ Loader animasiyasƒ±
    const style = document.createElement('style');
    style.textContent = `
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }`;
    document.head.appendChild(style);

    // √áap funksiyasƒ±
    function printCard() {
        const card = document.getElementById('printCard').outerHTML;
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`<html><head><title>Giri≈ü Kartƒ±</title></head><body>${card}</body></html>`);
        printWindow.document.close();
        printWindow.focus();
        setTimeout(() => printWindow.print(), 250);
    }

    // PDF Y√ºkl…ôm…ô funksiyasƒ±
    function downloadPDF(){
        const element=document.getElementById('printCard');
        html2pdf().set({
            margin:0,
            filename:`${document.getElementById('cardName').innerText}_Giris_Karti.pdf`,
            image:{type:'jpeg',quality:0.98},
            html2canvas:{scale:3},
            jsPDF:{unit:'mm',format:[105,148],orientation:'portrait'}
        }).from(element).save();
    }
</script>

</body>
</html>
